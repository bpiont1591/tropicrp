<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>TropicRP â€¢ Sklep</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#071a16;
  --card:#0f2f28;
  --accent:#2dd4bf;
  --danger:#ef4444;
  --warn:#f59e0b;
  --text:#e6fffa;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:
    linear-gradient(180deg,rgba(0,0,0,.5),rgba(0,0,0,.9)),
    url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e");
  background-size:cover;
  color:var(--text);
}
.wrap{max-width:1200px;margin:auto;padding:24px}
h1{margin:0 0 8px}
.grid{display:grid;grid-template-columns:1.6fr 1fr;gap:20px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.card{
  background:rgba(15,47,40,.92);
  border:1px solid rgba(255,255,255,.1);
  border-radius:16px;
  padding:16px;
}

.shopScroll{
  max-height:calc(100vh - 140px);
  overflow-y:auto;
}

.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-radius:12px;
  margin-bottom:8px;
  background:rgba(0,0,0,.25)
}
.price{font-weight:900;color:var(--accent)}

button{
  border:0;
  border-radius:10px;
  padding:8px 12px;
  background:var(--accent);
  color:#022c22;
  font-weight:900;
  cursor:pointer
}
button.red{background:var(--danger);color:white}
button.orange{background:var(--warn);color:#111}

.cartItem{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 0;
  border-bottom:1px solid rgba(255,255,255,.1)
}

input,textarea{
  width:100%;
  margin-top:8px;
  padding:10px;
  border-radius:10px;
  border:0;
  background:rgba(0,0,0,.3);
  color:white
}
textarea{resize:vertical}
.total{font-size:20px;font-weight:900;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">
<h1>ðŸŒ´ TropicRP â€¢ Sklep</h1>
<p>Realne pÅ‚atnoÅ›ci Stripe â€¢ Automatyczne potwierdzenie</p>

<div class="grid">
  <!-- SKLEP -->
  <div class="card shopScroll">
    <h2>ðŸ›’ UsÅ‚ugi</h2>

    <div class="item">
      <b>Limitowany pojazd</b>
      <div>
        <span class="price">120 zÅ‚</span>
        <button onclick="add('car','Limitowany pojazd',120)">+</button>
      </div>
    </div>

    <div class="item">
      <b>Anty-lag</b>
      <div>
        <span class="price">10 zÅ‚</span>
        <button onclick="add('antilag','Anty-lag',10)">+</button>
      </div>
    </div>

    <div class="item">
      <b>Custom Ped</b>
      <div>
        <span class="price">50 zÅ‚</span>
        <button onclick="add('ped','Custom Ped',50)">+</button>
      </div>
    </div>

    <div class="item">
      <b>Unban permanentny</b>
      <div>
        <span class="price">200 zÅ‚</span>
        <button onclick="add('unban','Unban permanentny',200)">+</button>
      </div>
    </div>
  </div>

  <!-- KOSZYK -->
  <div class="card">
    <h2>ðŸ’³ Koszyk</h2>
    <div id="cart"></div>
    <div class="total">Suma: <span id="total">0</span> zÅ‚</div>

    <input id="nick" placeholder="Nick / Discord">
    <input id="identifier" placeholder="ID w grze / Discord ID">
    <textarea id="notes" placeholder="Uwagi (opcjonalnie)"></textarea>

    <button style="width:100%;margin-top:12px" onclick="pay()">ZapÅ‚aÄ‡ (Stripe)</button>
  </div>
</div>
</div>

<script>
/* ================== CONFIG ================== */
const CHECKOUT_URL = "https://eoyfffyqo9gm4i.m.pipedream.net/";
const cart = new Map();

/* ================== KOSZYK ================== */
function add(id,name,price){
  const it = cart.get(id) || {id,name,price,qty:0};
  it.qty++;
  cart.set(id,it);
  render();
}
function removeOne(id){
  const it = cart.get(id);
  if(!it) return;
  it.qty<=1 ? cart.delete(id) : it.qty--;
  render();
}
function removeAll(id){
  cart.delete(id);
  render();
}
function render(){
  const el=document.getElementById("cart");
  el.innerHTML="";
  let sum=0;
  for(const it of cart.values()){
    sum+=it.price*it.qty;
    el.innerHTML+=`
      <div class="cartItem">
        <div><b>${it.name}</b> x${it.qty}</div>
        <div>
          <button class="orange" onclick="removeOne('${it.id}')">âˆ’</button>
          <button class="red" onclick="removeAll('${it.id}')">âœ•</button>
        </div>
      </div>`;
  }
  document.getElementById("total").textContent=sum;
}

/* ================== STRIPE PAY ================== */
async function pay(){
  try{
    if(cart.size===0) return alert("Koszyk pusty");

    const payload={
      customer:{
        nick:document.getElementById("nick").value.trim(),
        identifier:document.getElementById("identifier").value.trim()
      },
      items:[...cart.values()],
      notes:document.getElementById("notes").value
    };

    if(!payload.customer.nick || !payload.customer.identifier)
      return alert("UzupeÅ‚nij nick i ID");

    console.log("PAY payload:", payload);

    const r = await fetch(CHECKOUT_URL, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });

    const raw = await r.text();
    console.log("PIPEDREAM RAW RESPONSE:", raw);

    let data = {};
    try{ data = JSON.parse(raw); }catch{}

    if(!r.ok){
      alert("BÅ‚Ä…d Pipedream/Stripe:\n" + (data.error || raw || r.status));
      return;
    }

    if(!data.url){
      alert("Brak URL do Stripe.\nSprawdÅº Console (F12).");
      return;
    }

    // ðŸ”¥ PRZEKIEROWANIE
    window.location.href = data.url;

  }catch(err){
    console.error(err);
    alert("BÅ‚Ä…d JS: " + err.message);
  }
}
</script>
</body>
</html>
